<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excel-like Data Table</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- Cell Context Menu -->
    <div id="cellContextMenu" class="context-menu">
        <div class="context-menu-item" id="ctxBold" onclick="toggleCellBold()">
            <span class="checkmark">‚úì</span>
            <span>Bold</span>
        </div>
        <div class="context-menu-item" id="ctxItalic" onclick="toggleCellItalic()">
            <span class="checkmark">‚úì</span>
            <span>Italic</span>
        </div>
        <div class="context-menu-item" onclick="showUnifiedBorderOptions()">
            <span>üî≤</span>
            <span>Border Options</span>
        </div>
        <div class="context-menu-item" id="ctxCenter" onclick="toggleCellCenter()">
            <span class="checkmark">‚úì</span>
            <span>Center Align</span>
        </div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" onclick="showUnifiedColorPicker()">
            <span>üé®</span>
            <span>Cell Colors</span>
        </div>
        <div class="context-menu-item" onclick="setCellFontSize()">
            <span>üìè</span>
            <span>Font Size</span>
        </div>
        <div class="context-menu-item" onclick="clearCellFormatting()">
            <span>üßπ</span>
            <span>Clear Formatting</span>
        </div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" id="ctxMerge" onclick="mergeCells()">
            <span>‚äû</span>
            <span>Merge Cells</span>
        </div>
        <div class="context-menu-item" id="ctxUnmerge" onclick="unmergeCell()">
            <span>‚äü</span>
            <span>Unmerge Cell</span>
        </div>
    </div>

    <div class="container">
        <div class="sheet-tabs">
            <div class="category-controls">
                <div class="category-selector">
                    <button class="category-current" id="currentCategoryBtn" onclick="toggleCategoryList()">
                        <span id="currentCategoryName">Uncategorized</span>
                        <span class="dropdown-arrow">‚ñº</span>
                    </button>
                    <div class="category-list" id="categoryList"></div>
                </div>
                <button onclick="showAddCategoryModal()" class="btn-category-action" title="Add Category">
                    <span>‚ûï</span>
                </button>
                <button onclick="showRenameCategoryModal()" class="btn-category-action"
                    title="Rename Category (F1 to reorder)">
                    <span>‚úèÔ∏è</span>
                </button>
            </div>

            <div class="sheet-controls">
                <div class="sheet-selector">
                    <button class="sheet-current" id="currentSheetBtn" onclick="toggleSheetList()">
                        <span id="currentSheetName">Sheet1</span>
                        <span class="dropdown-arrow">‚ñº</span>
                    </button>
                    <div class="sheet-list" id="sheetList"></div>
                </div>
                <button onclick="addSheet()" class="btn-sheet-action" title="Add Sheet">
                    <span>‚ûï</span>
                </button>
                <button onclick="showRenameModal(currentSheet)" class="btn-sheet-action" title="Rename Sheet">
                    <span>‚úèÔ∏è</span>
                </button>
                <button onclick="showMoveToCategoryModal(currentSheet)" class="btn-sheet-action"
                    title="Move to Category">
                    <span>üìÅ</span>
                </button>
                <button onclick="deleteSheet(currentSheet)" class="btn-sheet-action" title="Delete Sheet">
                    <span>üóëÔ∏è</span>
                </button>
                <button onclick="openSettings()" class="btn-sheet-action" title="Settings">
                    <span>‚öôÔ∏è</span>
                </button>
            </div>
        </div>

        <div class="toolbar">
            <div class="button-group">
                <button onclick="addColumn()" class="btn-icon" title="Add Column">‚¨áÔ∏è</button>
                <button onclick="addRow()" class="btn-icon" title="Add Row">‚û°Ô∏è</button>
                <button onclick="saveData()" class="btn-icon" title="Save Data">üíæ</button>
                <button onclick="loadData()" class="btn-icon" title="Refresh">üîÑ</button>

                <label class="btn-icon-toggle" title="Enable text wrapping - Press Enter for new lines">
                    <input type="checkbox" id="wrapToggle" onchange="toggleRowWrap()">
                    <span>‚Ü©Ô∏è</span>
                </label>

                <label class="btn-icon-toggle" title="Show or hide row numbers">
                    <input type="checkbox" id="rowToggle" onchange="toggleRowNumbers()" checked>
                    <span>#Ô∏è‚É£</span>
                </label>

                <label class="btn-icon-toggle" title="Enable or disable markdown preview">
                    <input type="checkbox" id="markdownToggle" onchange="toggleMarkdownPreview()" checked>
                    <span>üìù</span>
                </label>
            </div>

            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Search..." onkeyup="searchTable()"
                    title="Search in all cells">
                <button onclick="clearSearch()" class="btn-clear-search" title="Clear search">√ó</button>
            </div>

            <div class="font-size-control">
                <span class="font-size-label">Font:</span>
                <button onclick="adjustFontSize(-1)" class="btn-font-size" title="Decrease font size">‚àí</button>
                <span id="fontSizeDisplay" class="font-size-display">100%</span>
                <button onclick="adjustFontSize(1)" class="btn-font-size" title="Increase font size">+</button>
            </div>
        </div>

        <div class="table-container">
            <table id="dataTable">
                <thead id="tableHead">
                    <tr id="headerRow"></tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>

    <!-- Column Settings Modal -->
    <div id="columnModal" class="modal">
        <div class="modal-content column-modal">
            <div class="modal-header">
                <h2 id="columnModalTitle">Add Column</h2>
                <span class="close" onclick="closeColumnModal()">&times;</span>
            </div>
            <form id="columnForm">
                <input type="hidden" id="editingColumnIndex" value="-1">

                <div class="form-group">
                    <label for="columnName">Column Name</label>
                    <input type="text" id="columnName" class="form-input" placeholder="Leave empty for auto (A, B, C...)"
                        autofocus>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="columnType">Data Type</label>
                        <select id="columnType" class="form-input">
                            <option value="text">Text</option>
                            <option value="number">Number</option>
                            <option value="date">Date</option>
                            <option value="email">Email</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="columnWidth">Width (px)</label>
                        <input type="number" id="columnWidth" class="form-input" value="150" min="1">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="columnFont">Font</label>
                        <select id="columnFont" class="form-input">
                            <option value="">Default</option>
                            <option value="JetBrains Mono">JetBrains Mono</option>
                            <option value="Arial">Arial</option>
                            <option value="Courier New">Courier New</option>
                            <option value="Georgia">Georgia</option>
                            <option value="Times New Roman">Times New Roman</option>
                            <option value="Verdana">Verdana</option>
                            <option value="Agency FB">Agency FB</option>
                            <option value="Comic Sans MS">Comic Sans MS</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="columnFontSize">Font Size (px)</label>
                        <input type="number" id="columnFontSize" class="form-input" value="18" min="8" max="72">
                    </div>
                </div>

                <div class="form-group">
                    <label for="columnColor">Background Color</label>
                    <div class="color-picker-wrapper">
                        <input type="color" id="columnColor" class="color-input" value="#ffffff">
                        <input type="text" id="columnColorText" class="form-input color-text" value="#FFFFFF" readonly>
                    </div>
                </div>

                <div class="form-group">
                    <label for="columnTextColor">Text Color</label>
                    <div class="color-picker-wrapper">
                        <input type="color" id="columnTextColor" class="color-input" value="#000000">
                        <input type="text" id="columnTextColorText" class="form-input color-text" value="#000000"
                            readonly>
                    </div>
                </div>

                <!-- Header Styling Section -->
                <div class="form-section-header">
                    <h3>Header Styling</h3>
                </div>

                <div class="form-group">
                    <label for="headerBgColor">Header Background Color</label>
                    <div class="color-picker-wrapper">
                        <input type="color" id="headerBgColor" class="color-input" value="#f8f9fa">
                        <input type="text" id="headerBgColorText" class="form-input color-text" value="#F8F9FA"
                            readonly>
                    </div>
                </div>

                <div class="form-group">
                    <label for="headerTextColor">Header Text Color</label>
                    <div class="color-picker-wrapper">
                        <input type="color" id="headerTextColor" class="color-input" value="#333333">
                        <input type="text" id="headerTextColorText" class="form-input color-text" value="#333333"
                            readonly>
                    </div>
                </div>

                <div class="form-group">
                    <label>Header Text Style</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="headerBold">
                            <span>Bold</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="headerItalic">
                            <span>Italic</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="headerCenter">
                            <span>Center Align</span>
                        </label>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeColumnModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="columnSubmitBtn">Add Column</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Rename Sheet Modal -->
    <div id="renameModal" class="modal">
        <div class="modal-content rename-modal">
            <div class="modal-header">
                <h2>Rename Sheet</h2>
                <span class="close" onclick="closeRenameModal()">&times;</span>
            </div>
            <form id="renameForm">
                <div class="form-group">
                    <label for="sheetName">Sheet Name</label>
                    <input type="text" id="sheetName" class="form-input" placeholder="Enter sheet name" required
                        autofocus>
                </div>
                <div class="form-group">
                    <label for="sheetNickname">Nickname (optional, for easier searching)</label>
                    <input type="text" id="sheetNickname" class="form-input" placeholder="e.g., English name for Bangla sheet">
                    <small style="color: #666; font-size: 12px;">Nickname won't be displayed but can be used to search with *</small>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeRenameModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Category Modal -->
    <div id="addCategoryModal" class="modal">
        <div class="modal-content rename-modal">
            <div class="modal-header">
                <h2>Add Category</h2>
                <span class="close" onclick="closeAddCategoryModal()">&times;</span>
            </div>
            <form id="addCategoryForm">
                <div class="form-group">
                    <label for="categoryName">Category Name</label>
                    <input type="text" id="categoryName" class="form-input"
                        placeholder="e.g., Bengali, English, History" required autofocus>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeAddCategoryModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Category</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Rename Category Modal -->
    <div id="renameCategoryModal" class="modal">
        <div class="modal-content rename-modal">
            <div class="modal-header">
                <h2>Rename Category</h2>
                <span class="close" onclick="closeRenameCategoryModal()">&times;</span>
            </div>
            <form id="renameCategoryForm">
                <div class="form-group">
                    <label for="newCategoryName">New Category Name</label>
                    <input type="text" id="newCategoryName" class="form-input" placeholder="Enter new category name"
                        required autofocus>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeRenameCategoryModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Rename</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Move to Category Modal -->
    <div id="moveToCategoryModal" class="modal">
        <div class="modal-content rename-modal">
            <div class="modal-header">
                <h2>Move Sheet to Category</h2>
                <span class="close" onclick="closeMoveToCategoryModal()">&times;</span>
            </div>
            <form id="moveToCategoryForm">
                <div class="form-group">
                    <label for="targetCategory">Select Category</label>
                    <select id="targetCategory" class="form-input">
                        <option value="">Uncategorized</option>
                    </select>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeMoveToCategoryModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Move</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content settings-modal">
            <div class="modal-header">
                <h2>Settings</h2>
                <span class="close" onclick="closeSettingsModal()">&times;</span>
            </div>
            <div class="settings-content">
                <button class="btn btn-primary" onclick="showMarkdownGuide()"
                    style="width: 100%; padding: 15px; font-size: 16px;">
                    üìù Markdown Guide
                </button>
            </div>
        </div>
    </div>

    <!-- Markdown Guide Modal -->
    <div id="markdownGuideModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2>Markdown Formatting Guide</h2>
                <span class="close" onclick="closeMarkdownGuide()">&times;</span>
            </div>
            <div style="padding: 24px; max-height: 70vh; overflow-y: auto;">
                <div style="margin-bottom: 20px;">
                    <h3 style="color: #007bff; margin-bottom: 10px;">Text Formatting</h3>
                    <table style="width: 100%; border-collapse: collapse;">
                        <tr style="border-bottom: 1px solid #ddd;">
                            <td style="padding: 8px; font-family: monospace; background: #f8f9fa;">**bold text**</td>
                            <td style="padding: 8px;"><strong>bold text</strong></td>
                        </tr>
                        <tr style="border-bottom: 1px solid #ddd;">
                            <td style="padding: 8px; font-family: monospace; background: #f8f9fa;">@@italic text@@</td>
                            <td style="padding: 8px;"><em>italic text</em></td>
                        </tr>
                        <tr style="border-bottom: 1px solid #ddd;">
                            <td style="padding: 8px; font-family: monospace; background: #f8f9fa;">__underline__</td>
                            <td style="padding: 8px;"><u>underline</u></td>
                        </tr>
                        <tr style="border-bottom: 1px solid #ddd;">
                            <td style="padding: 8px; font-family: monospace; background: #f8f9fa;">~~strikethrough~~
                            </td>
                            <td style="padding: 8px;"><del>strikethrough</del></td>
                        </tr>
                        <tr style="border-bottom: 1px solid #ddd;">
                            <td style="padding: 8px; font-family: monospace; background: #f8f9fa;">^superscript^</td>
                            <td style="padding: 8px;">text<sup>superscript</sup></td>
                        </tr>
                        <tr style="border-bottom: 1px solid #ddd;">
                            <td style="padding: 8px; font-family: monospace; background: #f8f9fa;">~subscript~</td>
                            <td style="padding: 8px;">text<sub>subscript</sub></td>
                        </tr>
                        <tr style="border-bottom: 1px solid #ddd;">
                            <td style="padding: 8px; font-family: monospace; background: #f8f9fa;">##heading##</td>
                            <td style="padding: 8px;"><span style="font-size: 1.3em; font-weight: 600;">heading</span>
                            </td>
                        </tr>
                    </table>
                </div>

                <div style="margin-bottom: 20px;">
                    <h3 style="color: #007bff; margin-bottom: 10px;">Code & Highlights</h3>
                    <table style="width: 100%; border-collapse: collapse;">
                        <tr style="border-bottom: 1px solid #ddd;">
                            <td style="padding: 8px; font-family: monospace; background: #f8f9fa;">`inline code`</td>
                            <td style="padding: 8px;"><code>inline code</code></td>
                        </tr>
                        <tr style="border-bottom: 1px solid #ddd;">
                            <td style="padding: 8px; font-family: monospace; background: #f8f9fa;">==highlight==</td>
                            <td style="padding: 8px;"><mark>highlight</mark></td>
                        </tr>
                    </table>
                </div>

                <div style="margin-bottom: 20px;">
                    <h3 style="color: #007bff; margin-bottom: 10px;">Lists</h3>
                    <table style="width: 100%; border-collapse: collapse;">
                        <tr style="border-bottom: 1px solid #ddd;">
                            <td style="padding: 8px; font-family: monospace; background: #f8f9fa;">- item</td>
                            <td style="padding: 8px;">‚Ä¢ item</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #ddd;">
                            <td style="padding: 8px; font-family: monospace; background: #f8f9fa;">-- subitem</td>
                            <td style="padding: 8px; padding-left: 24px;">‚ó¶ subitem</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #ddd;">
                            <td style="padding: 8px; font-family: monospace; background: #f8f9fa;">1. item</td>
                            <td style="padding: 8px;">1. item</td>
                        </tr>
                    </table>
                </div>

                <div style="margin-bottom: 20px;">
                    <h3 style="color: #007bff; margin-bottom: 10px;">Links</h3>
                    <table style="width: 100%; border-collapse: collapse;">
                        <tr style="border-bottom: 1px solid #ddd;">
                            <td style="padding: 8px; font-family: monospace; background: #f8f9fa; font-size: 12px;">
                                {link:https://google.com}Google{/}</td>
                            <td style="padding: 8px;"><a href="https://google.com" target="_blank" style="color: #007bff; text-decoration: underline;">Google</a></td>
                        </tr>
                    </table>
                </div>

                <div style="margin-bottom: 20px;">
                    <h3 style="color: #007bff; margin-bottom: 10px;">Custom Colors</h3>
                    <table style="width: 100%; border-collapse: collapse;">
                        <tr style="border-bottom: 1px solid #ddd;">
                            <td style="padding: 8px; font-family: monospace; background: #f8f9fa; font-size: 12px;">
                                {fg:red}red text{/}</td>
                            <td style="padding: 8px;"><span
                                    style="color: red; padding: 2px 6px; border-radius: 4px; display: inline-block;">red
                                    text</span></td>
                        </tr>
                        <tr style="border-bottom: 1px solid #ddd;">
                            <td style="padding: 8px; font-family: monospace; background: #f8f9fa; font-size: 12px;">
                                {bg:yellow}highlighted{/}</td>
                            <td style="padding: 8px;"><span
                                    style="background-color: yellow; padding: 2px 6px; border-radius: 4px; display: inline-block;">highlighted</span>
                            </td>
                        </tr>
                        <tr style="border-bottom: 1px solid #ddd;">
                            <td style="padding: 8px; font-family: monospace; background: #f8f9fa; font-size: 12px;">
                                {fg:white;bg:blue}badge{/}</td>
                            <td style="padding: 8px;"><span
                                    style="color: white; background-color: blue; padding: 2px 6px; border-radius: 4px; display: inline-block;">badge</span>
                            </td>
                        </tr>
                        <tr style="border-bottom: 1px solid #ddd;">
                            <td style="padding: 8px; font-family: monospace; background: #f8f9fa; font-size: 12px;">
                                {fg:#28cb5d}hex color{/}</td>
                            <td style="padding: 8px;"><span
                                    style="color: #28cb5d; padding: 2px 6px; border-radius: 4px; display: inline-block;">hex
                                    color</span></td>
                        </tr>
                    </table>
                </div>

                <div style="background: #e7f3ff; padding: 15px; border-radius: 6px; border-left: 4px solid #007bff;">
                    <strong>üí° Tips:</strong>
                    <ul style="margin: 10px 0 0 20px;">
                        <li>You can combine multiple formats</li>
                        <li>Colors support: named colors (red, blue), hex (#ff0000), rgb(255,0,0)</li>
                        <li>Use wrap mode for multi-line content</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- F1 Quick Navigation Popup -->
    <div id="f1Popup" class="f1-popup-overlay">
        <div class="f1-popup">
            <div class="f1-popup-header">
                <h3>Quick Navigation</h3>
                <button class="f1-close" onclick="closeF1Popup()">&times;</button>
            </div>
            <div class="f1-search-box">
                <input type="text" id="f1SearchInput" placeholder="Search sheets... (* for all, # for content)"
                    onkeyup="filterF1Sheets()" onkeydown="handleF1SearchKeydown(event)">
            </div>
            <div class="f1-content">
                <div class="f1-categories">
                    <div class="f1-category-title">
                        <span>Categories</span>
                        <div class="f1-category-actions">
                            <button class="f1-category-action-btn" onclick="moveCategoryUpInF1()"
                                title="Move selected category up">‚¨ÜÔ∏è</button>
                            <button class="f1-category-action-btn" onclick="moveCategoryDownInF1()"
                                title="Move selected category down">‚¨áÔ∏è</button>
                        </div>
                    </div>
                    <div id="f1CategoryList" class="f1-category-list"></div>
                </div>
                <div class="f1-sheets">
                    <div class="f1-sheets-title">Sheets</div>
                    <div id="f1SheetList" class="f1-sheet-list"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>

</html>