<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="https://cdn-icons-png.flaticon.com/512/2250/2250195.png" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PC File Browser</title>

    <style>
        @import url("https://www.nerdfonts.com/assets/css/webfont.css");

        body {
            font-family: JetBrainsMono NFP, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* WebKit browsers (Chrome, Safari) */
        html,
        body {
            background-color: #bad1ff;
            scrollbar-width: thin;
            scrollbar-color: #ff0000 #000000;
            /* black background and red thumb */
        }

        /* WebKit browsers (Chrome, Safari) */
        html::-webkit-scrollbar,
        body::-webkit-scrollbar {
            width: 1px;
            /* Set the width of the scrollbar */
        }

        html::-webkit-scrollbar-thumb,
        body::-webkit-scrollbar-thumb {
            background-color: #ff000f;
            /* Color of the thumb (red) */
        }

        html::-webkit-scrollbar-track,
        body::-webkit-scrollbar-track {
            background-color: #000000;
            /* Color of the track (black) */
        }


        h1 {
            color: #333;
        }

        .container {
            display: flex;
            justify-content: space-between;
            height: 100%;
            gap: 20px;
            overflow: hidden;
            width: 100%;
        }

        .container div {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            max-height: 100%;
            min-width: 0;
        }

        .directories-panel {
            border-right: 1px solid #ccc;
            padding-right: 10px;
        }

        .files-panel {
            padding-left: 10px;
        }

        .directory-list {
            margin-top: 20px;
            padding: 0;
            display: flex;
            /* Enable flex layout */
            flex-wrap: wrap;
            /* Wrap items to the next row */
        }

        .directory-list li {
            list-style-type: none;
            margin: 5px;
            /* Use margin on all sides for spacing */
            display: flex;
            align-items: center;
            /* Center vertically */
            padding: 10px;
            border-radius: 0px;
            background-color: #3f3d36;
            flex-grow: 1;
            /* Allow items to grow and fill available space */
            text-align: center;
        }

        .directory-list a {
            text-decoration: none;
            color: #e3e300;
            font-weight: bold;
            overflow-wrap: anywhere;
            width: 100%;
        }

        .folder-icon {
            margin-right: 5px;
            color: yellow;
        }

        .file-list {
            margin-top: 20px;
            padding: 0;
        }

        .file-list li {
            list-style-type: none;
            margin: 5px 0;
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: 0px;
        }



        .directory-list li {
            background-color: #3f3d36;
        }

        .directory-list a:hover {
            text-decoration: underline;
        }

        .file-list a {
            text-decoration: none;
            color: #ffffff;
            font-weight: bold;
        }

        .file-list li {
            background-color: #282a36;
        }

        .file-modified-time {
            font-size: 12px;
            color: #ddd;
            margin-left: 10px;
        }

        .file-list a:hover {
            text-decoration: underline;
        }

        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            border-radius: 0px;
            background-color: #282a36;
            width: 100%;
            box-sizing: border-box;
            min-width: 0;
        }

        .file-name {
            flex: 1;
            word-break: break-word;
            overflow-wrap: break-word;
            min-width: 0;
            overflow: hidden;
        }



        .top-navigation {
            flex-shrink: 0;
            padding: 10px;
            background-color: #bad1ff;
            z-index: 9999;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 10px;
            border-bottom: 1px solid #999;
            min-height: 60px;
        }

        .nav-groups {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            flex: 1;
        }

        .drive-group,
        .bookmark-group,
        .explorer-group {
            font-family: JetBrainsMono NFP, sans-serif;
            display: flex;
            align-items: center;
            background-color: #333;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            gap: 10px;
        }

        .bookmark-group {
            background-color: #444;
        }

        .explorer-group {
            background-color: #555;
        }

        .drive-group form {
            margin: 0;
        }

        .drive-group button,
        .bookmark-group button,
        .explorer-group button {
            background-color: transparent;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            white-space: nowrap;
        }

        .drive-group button:hover,
        .bookmark-group button:hover,
        .explorer-group button:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .explorer-btn {
            background-color: #2196F3 !important;
        }

        .explorer-btn:hover {
            background-color: #1976D2 !important;
        }

        /* Make download link look exactly like explorer button but green */
        a.explorer-btn {
            display: inline-block;
            background-color: #4CAF50 !important;
            color: white !important;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            white-space: nowrap;
            text-decoration: none;
        }

        a.explorer-btn:hover {
            background-color: #45a049 !important;
        }

        .download-btn-custom {
            background-color: #4CAF50 !important;
        }

        .download-btn-custom:hover {
            background-color: #45a049 !important;
        }

        .bookmark-bar {
            font-family: JetBrainsMono NFP, sans-serif;
            position: fixed;
            z-index: 9998;
            display: flex;
            align-items: center;
            background-color: #444;
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            top: 60px;
            left: 10px;
            width: auto;
            overflow: visible;
        }

        .bookmark-bar button {
            background-color: #555;
            color: white;
            border: none;
            padding: 5px 10px;
            margin-right: 5px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            white-space: nowrap;
        }

        .bookmark-bar button:hover {
            background-color: #666;
        }

        .bookmark-add-btn {
            background-color: #4CAF50 !important;
        }

        .bookmark-add-btn:hover {
            background-color: #45a049 !important;
        }

        .bookmark-dropdown {
            position: relative;
            display: inline-block;
        }

        .filter-section {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 5px;
        }

        /* Responsive behavior */
        @media screen and (max-width: 1024px) {
            .top-navigation {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .nav-groups {
                flex-wrap: wrap;
                justify-content: flex-start;
            }

            .filter-section {
                align-self: flex-start;
            }
        }

        @media screen and (max-width: 768px) {
            .nav-groups {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }

            .drive-group,
            .bookmark-group,
            .explorer-group {
                width: auto;
                justify-content: flex-start;
            }

            .filter-section {
                align-self: flex-start;
            }

            .container {
                flex-direction: column;
                gap: 0;
                height: auto;
            }

            .container div {
                overflow-y: visible;
                max-height: none;
                flex: none;
            }

            .directories-panel,
            .files-panel {
                border: none;
                padding: 10px 0;
                border-right: none;
                padding-right: 0;
                padding-left: 0;
            }

            .directories-panel {
                border-bottom: 1px solid #ccc;
                margin-bottom: 10px;
            }

            .file-name {
                word-break: break-word;
                overflow-wrap: anywhere;
                hyphens: auto;
                max-width: 100%;
            }

            .file-name a {
                word-break: break-word;
                overflow-wrap: anywhere;
                white-space: normal;
            }

            .file-item {
                flex-wrap: nowrap;
                align-items: center;
            }

            .file-name {
                flex: 1;
                min-width: 0;
                word-break: break-word;
                overflow-wrap: break-word;
                white-space: normal;
                max-width: calc(100% - 80px);
            }

            .action-buttons {
                display: flex;
                gap: 5px;
                flex-shrink: 0;
                justify-content: flex-start;
            }

            .edit-btn,
            .download-btn {
                margin-left: 0;
                margin-right: 0;
            }
        }

        .bookmark-dropdown-content {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background-color: #2e2e2e;
            min-width: 250px;
            max-width: 400px;
            box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.3);
            z-index: 10000;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #555;
            border-radius: 5px;
            margin-top: 5px;
        }

        .bookmark-dropdown-content.show {
            display: block;
        }

        .bookmark-dropdown-content a {
            color: #ffffff;
            padding: 10px 15px;
            text-decoration: none;
            display: block;
            font-size: 13px;
            border-bottom: 1px solid #444;
        }

        .bookmark-dropdown-content a:hover {
            background-color: #444;
        }

        .bookmark-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 15px;
            border-bottom: 1px solid #444;
        }

        .bookmark-item:hover {
            background-color: #444;
        }

        .bookmark-item a {
            flex-grow: 1;
            padding: 0;
            border: none;
        }

        .bookmark-controls {
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .bookmark-move-up,
        .bookmark-move-down,
        .bookmark-remove {
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            padding: 2px 4px;
            border-radius: 3px;
            transition: background-color 0.2s;
        }

        .bookmark-move-up {
            color: #4CAF50;
        }

        .bookmark-move-up:hover {
            background-color: #4CAF50;
            color: white;
        }

        .bookmark-move-down {
            color: #2196F3;
        }

        .bookmark-move-down:hover {
            background-color: #2196F3;
            color: white;
        }

        .bookmark-remove {
            color: #ff6b6b;
        }

        .bookmark-remove:hover {
            background-color: #ff6b6b;
            color: white;
        }

        .back-btn {
            padding: 3px 3px;
            color: rgb(255, 255, 255);
            border-radius: 5px;
            text-decoration: none;
        }

        .back-btn:hover {
            color: #e64b2c;
        }

        .path-section {
            flex-shrink: 0;
            padding: 10px 20px;
            background-color: #bad1ff;
            border-bottom: 1px solid #999;
        }

        .current-path {
            font-weight: bold;
            margin: 0;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 2px;
        }

        .path-link {
            color: #2196F3;
            text-decoration: none;
            padding: 2px 4px;
            border-radius: 3px;
            transition: background-color 0.2s;
        }

        .path-link:hover {
            background-color: rgba(33, 150, 243, 0.1);
            text-decoration: underline;
        }

        .path-separator {
            color: #666;
            margin: 0 2px;
            user-select: none;
        }

        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .flash {
            color: green;
            font-weight: bold;
            margin-top: 20px;
        }

        .dot {
            margin-right: 8px;
            color: #6bc0f8;
        }



        #filter-btn {
            font-family: JetBrainsMono NFP, sans-serif;
            position: fixed;
            /* Fix it at the top */
            top: 10px;
            /* 10px from the top */
            right: 10px;
            /* 10px from the right */
            z-index: 9999;
            /* Ensure it's on top of other elements */
            background-color: #08ff3d;
            /* Dark background */
            color: rgb(0, 0, 0);
            padding: 10px 15px;
            border: 2px thin;
            border-radius: 0px;
            border: 2px thin;
            cursor: pointer;
        }

        #filter-btn:hover {
            background-color: #555;
            /* Lighter color on hover */
        }

        #resetFilterBtn {
            font-family: JetBrainsMono NFP, sans-serif;
            position: fixed;
            /* Fix it at the top */
            top: 60px;
            /* 60px from the top (below filter button) */
            right: 10px;
            /* 10px from the right (same as filter button) */
            z-index: 9998;
            /* Below filter button but above other elements */
            background-color: #ff6b6b;
            color: white;
            padding: 10px 15px;
            border: 2px solid black;
            border-radius: 0px;
            cursor: pointer;
        }

        #resetFilterBtn:hover {
            background-color: #ff5252;
        }

        #filter-panel {
            display: none;
            /* Initially hidden */
            position: fixed;
            /* Fixed position relative to the viewport */
            top: 80px;
            /* Position it below the navigation bar */
            right: 10px;
            /* Align it to the right */
            background-color: white;
            padding: 5px;
            border: 1px solid #ccc;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 10001;
            /* Higher z-index to appear above everything */
            width: 300px;
            /* Set the width of the filter panel */
            max-height: 75%;
            /* Ensure it doesn't take up the entire screen height */
            overflow-y: auto;
            /* Scroll if content exceeds max-height */
        }

        .filter-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            /* Three equal columns */
            gap: 10px;
            /* Space between columns */
            max-width: 600px;
            /* Prevents full-width stretching */
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
            background-color: #2e2e2e;
            /* Optional background */
            padding: 10px;
            border-radius: 5px;
        }

        .filter-group h4 {
            height: 50px;
            margin: 0;
            font-size: 13px;
            color: yellow;
            text-align: center;
            align-content: center;
        }

        .filter-group label {
            color: #ffffff;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
        }

        /* Apply Filter Button Styles */
        #filter-panel button {
            font-family: JetBrainsMono NFP, sans-serif;
            display: block;
            /* Make button a block-level element */
            margin: 5px auto 0;
            /* Center the button horizontally and add top margin */
            padding: 10px 20px;
            /* Add some padding for the button */
            background-color: #4CAF50;
            /* Green background */
            color: white;
            /* White text */
            font-size: 14px;
            font-weight: bold;
            border: none;
            /* Remove border */
            border-radius: 5px;
            /* Rounded corners */
            cursor: pointer;
            /* Pointer cursor on hover */
            text-align: center;
            /* Center text inside the button */
            transition: background-color 0.3s ease;
            /* Smooth background color transition */
        }

        /* Hover effect for the button */
        #filter-panel button:hover {
            background-color: #fc5c2c;
            /* Darker green when hovering */
        }


        .download-btn {
            padding: 5px 10px;
            background-color: #4CAF50 !important;
            color: white !important;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 5px;
            margin-right: 10px;
        }

        .download-btn:hover {
            background-color: #45a049 !important;
        }

        .edit-btn {
            padding: 5px 10px;
            background-color: #a5d9fc;
            color: black !important;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 5px;
        }

        .edit-btn:hover {
            background-color: rgb(103, 113, 255);
            /* Change hover effect */
        }

        .pdf-btn {
            padding: 5px 10px;
            background-color: transparent;
            color: #333 !important;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 5px;
            text-decoration: none;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .pdf-btn:hover {
            background-color: #f0f0f0;
        }

        button:hover {
            background-color: #45a049;
        }


        .action-buttons {
            display: flex;
            align-items: center;
            gap: 5px;
            flex-shrink: 0;
        }

        /* Desktop: Use contents for right alignment */
        @media screen and (min-width: 769px) {
            .action-buttons {
                display: contents;
            }
        }

        .file-actions {
            position: relative;
            display: inline-block;
        }

        .dots-btn {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #ff0000;
            padding: 5px;
        }

        .dots-btn:hover {
            color: #000;
        }

        .context-menu {
            display: none;
            position: fixed;
            background-color: #fff;
            border: 1px solid #ccc;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            width: 120px;
            z-index: 9999;
            padding: 2px 0;
            border-radius: 4px;
        }

        .context-menu a {
            display: block;
            padding: 8px 10px;
            color: #333;
            text-decoration: none;
            font-size: 14px;
        }

        .context-menu a:hover {
            background-color: #f1f1f1;
        }

        .dropdown-menu a {
            display: block;
            padding: 8px 10px;
            color: #333;
            text-decoration: none;
            font-size: 14px;
        }

        .dropdown-menu a:hover {
            background-color: #f1f1f1;
        }

        .dropdown-menu a .nf {
            margin-right: 8px;
        }


        /* Media query for mobile screens */
        @media screen and (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                flex-direction: column;
            }

            .drive-back-container {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>

<body>

    <!-- <h1>Browse PC Files</h1> -->
    <div class="top-navigation">
        <div class="nav-groups">
            <!-- Drive Group -->
            <div class="drive-group">
                <form method="GET" action="/">
                    <button type="submit" name="drive" value="C:/"><i class="nf nf-md-alpha_c"></i>:\\</button>
                </form>
                <form method="GET" action="/">
                    <button type="submit" name="drive" value="D:/"><i class="nf nf-md-alpha_d"></i>:\\</button>
                </form>
                <form method="GET" action="/">
                    <button type="submit" name="drive" value="C:/Users/nahid/"><i class="nf nf-fa-user"></i></button>
                </form>
                <form method="GET" action="/">
                    <button type="submit" name="drive" value="C:/Users/nahid/Desktop/"><i
                            class="nf nf-fa-desktop"></i></button>
                </form>
                <a href="/back?dir_path={{ current_dir }}&drive={{ current_drive }}" class="back-btn"><i
                        class="nf nf-fa-arrow_left"></i></a>
            </div>

            <!-- Bookmark Group -->
            <div class="bookmark-group">
                <button class="bookmark-add-btn" onclick="addBookmark()">
                    <i class="nf nf-fa-bookmark"></i> Add
                </button>

                <div class="bookmark-dropdown">
                    <button onclick="toggleBookmarkDropdown(event)">
                        <i class="nf nf-fa-chevron_down"></i> Bookmarks
                    </button>
                    <div class="bookmark-dropdown-content" id="bookmarkDropdown">
                        {% for bookmark in bookmarks %}
                        <div class="bookmark-item">
                            <a href="/?dir_path={{ bookmark.path | urlencode }}&drive={{ bookmark.path | urlencode }}"
                                onclick="closeBookmarkDropdown()">
                                <i class="nf nf-fa-folder"></i> {{ bookmark.name }}
                            </a>
                            <div class="bookmark-controls">
                                <span class="bookmark-move-up"
                                    onclick="event.stopPropagation(); moveBookmark('{{ bookmark.path | replace("'", "\\'") }}', 'up');"
                                    title="Move up">‚Üë</span>
                                <span class="bookmark-move-down"
                                    onclick="event.stopPropagation(); moveBookmark('{{ bookmark.path | replace("'", "\\'") }}', 'down');"
                                    title="Move down">‚Üì</span>
                                <span class="bookmark-remove"
                                    onclick="event.stopPropagation(); removeBookmark('{{ bookmark.path | replace("'", "\\'") }}');"
                                    title="Remove">√ó</span>
                            </div>
                        </div>
                        {% endfor %}
                        {% if not bookmarks %}
                        <div style="padding: 10px 15px; color: #999; font-style: italic; text-align: center;">
                            No bookmarks yet
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Move Folders Group -->
            <div class="bookmark-group" style="background-color: #666;">
                <button class="bookmark-add-btn" onclick="addMoveFolder()" style="background-color: #FF9800;">
                    <i class="nf nf-fa-folder_open"></i> Add Move
                </button>

                <div class="bookmark-dropdown">
                    <button onclick="toggleMoveFolderDropdown(event)" style="background-color: #FF9800;">
                        <i class="nf nf-fa-chevron_down"></i> Move Folders
                    </button>
                    <div class="bookmark-dropdown-content" id="moveFolderDropdown">
                        <!-- Move folders will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Explorer Group -->
            <div class="explorer-group">
                <button class="explorer-btn" onclick="openInExplorer()">
                    <i class="nf nf-fa-folder_open"></i> Explorer
                </button>
                <a href="/download_directory?dir_path={{ current_dir | urlencode }}" class="explorer-btn"
                    style="text-decoration: none;">
                    <i class="nf nf-fa-download"></i> Download
                </a>
            </div>
        </div>

        <div class="filter-section">
            <button id="filter-btn" onclick="toggleFilterPanel()">Filter</button>
            <button id="resetFilterBtn" onclick="resetFilter()" style="display: none;">
                Reset
            </button>
        </div>
    </div>



    <div id="filter-panel" style="display: none;">
        <div class="filter-container">
            <div class="filter-group">
                <h4>Images</h4>
                <label><input type="checkbox" class="file-filter" value="jpg"> .jpg</label>
                <label><input type="checkbox" class="file-filter" value="png"> .png</label>
                <label><input type="checkbox" class="file-filter" value="gif"> .gif</label>
            </div>

            <div class="filter-group">
                <h4>Videos & Audio</h4>
                <label><input type="checkbox" class="file-filter" value="mp3"> .mp3</label>
                <label><input type="checkbox" class="file-filter" value="mp4"> .mp4</label>
                <label><input type="checkbox" class="file-filter" value="webm"> .webm</label>
                <label><input type="checkbox" class="file-filter" value="mkv"> .mkv</label>
            </div>

            <div class="filter-group">
                <h4>Scripts</h4>
                <label><input type="checkbox" class="file-filter" value="ahk"> .ahk</label>
                <label><input type="checkbox" class="file-filter" value="ps1"> .ps1</label>
                <label><input type="checkbox" class="file-filter" value="py"> .py</label>
            </div>

            <div class="filter-group">
                <h4>Web Files</h4>
                <label><input type="checkbox" class="file-filter" value="html"> .html</label>
                <label><input type="checkbox" class="file-filter" value="css"> .css</label>
                <label><input type="checkbox" class="file-filter" value="org"> .org</label>
                <label><input type="checkbox" class="file-filter" value="log"> .log</label>
                <label><input type="checkbox" class="file-filter" value="ini"> .ini</label>
                <label><input type="checkbox" class="file-filter" value="txt"> .txt</label>
            </div>

            <div class="filter-group">
                <h4>Documents</h4>
                <label><input type="checkbox" class="file-filter" value="doc"> .doc</label>
                <label><input type="checkbox" class="file-filter" value="docx"> .docx</label>
                <label><input type="checkbox" class="file-filter" value="xlsx"> .xlsx</label>
                <label><input type="checkbox" class="file-filter" value="pptx"> .pptx</label>
                <label><input type="checkbox" class="file-filter" value="pdf"> .pdf</label>
            </div>

            <div class="filter-group">
                <h4>Compressed & Executables</h4>
                <label><input type="checkbox" class="file-filter" value="exe"> .exe</label>
                <label><input type="checkbox" class="file-filter" value="apk"> .apk</label>
                <label><input type="checkbox" class="file-filter" value="zip"> .zip</label>
                <label><input type="checkbox" class="file-filter" value="rar"> .rar</label>
                <label><input type="checkbox" class="file-filter" value="7z"> .7z</label>
                <label><input type="checkbox" class="file-filter" value="iso"> .iso</label>
            </div>
        </div>

        <button onclick="applyFilter()">Apply Filter</button>
    </div>



    <!-- Path Section -->
    <div class="path-section">
        <div class="current-path">
            {% set path_parts = current_dir.replace('\\', '/').split('/') %}
            {% for part in path_parts %}
            {% if part %}
            {% set accumulated_path = path_parts[:loop.index] | join('/') %}
            <a href="/?dir_path={{ accumulated_path | urlencode }}&drive={{ current_drive | urlencode }}"
                class="path-link">{{ part }}</a>
            {% if not loop.last %}<span class="path-separator">/</span>{% endif %}
            {% endif %}
            {% endfor %}
        </div>
    </div>

    <!-- Scrollable Content Area -->
    <div class="content-area">
        <div class="container">
            <!-- Left Panel: Directories -->
            <div class="directories-panel">
                <h3>Directories:</h3>
                <ul class="directory-list">
                    {% for directory in directories %}
                    <li>
                        <span class="folder-icon"></span>
                        <a href="/?dir_path={{ current_dir }}/{{ directory }}&drive={{ current_drive }}">{{ directory
                            }}</a>
                    </li>
                    {% endfor %}
                </ul>
            </div>

            <!-- Right Panel: Files -->
            <div class="files-panel">
                <h3>Files:</h3>
                <ul class="file-list">
                    {% for file in files %}
                    <li class="file-item" data-filetype="{{ file.split('.')[-1] }}">
                        <!-- Action buttons grouped together on the right -->

                        <div class="file-name" oncontextmenu="showContextMenu(event, '{{ file }}'); return false;">
                            <span>{{ file_icons[file] }}</span>
                            <a href="/view/{{ current_dir }}/{{ file | urlencode }}">{{ file }}</a>
                            <br>
                            <small style="color: #ddd;">
                                {{ file_times[file] }} - {{ file_sizes[file] }}
                            </small>
                        </div>
                        <div class="action-buttons">
                            {% if file.endswith(editable_extensions) %}
                            <a href="/edit/{{ current_dir }}/{{ file }}" class="edit-btn"></a>
                            {% endif %}
                            {% if file.lower().endswith('.pdf') %}
                            <a href="/view/{{ current_dir }}/{{ file | urlencode }}?annotate=true" class="pdf-btn" title="Quick Move PDF">üìÅ</a>
                            {% endif %}
                            <a href="/download/{{ current_dir }}/{{ file | urlencode }}" class="download-btn"></a>
                        </div>

                        <!-- Right-click context menu (hidden by default) -->
                        <div class="context-menu" id="context-{{ file }}">
                            {% if file.lower().endswith('.pdf') %}
                            <a href="/view/{{ current_dir }}/{{ file | urlencode }}?annotate=true">
                                <i class="nf nf-md-draw"></i> Quick Move PDF
                            </a>
                            {% endif %}
                            <a href="#" class="rename-btn" onclick="renameFile('{{ current_dir }}', '{{ file }}')">
                                <i class="nf nf-md-rename_box"></i> Rename
                            </a>
                            <a href="#" class="delete-btn" onclick="deleteFile('{{ current_dir }}', '{{ file }}')">
                                <i class="nf nf-fa-trash"></i> Delete
                            </a>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>

    </div>

    {% with messages = get_flashed_messages() %}
    {% if messages %}
    <div class="flash">{{ messages[0] }}</div>
    {% endif %}
    {% endwith %}
    </div>
    <script>
        function renameFile(currentDir, fileName) {
            const newFileName = prompt("Enter new name for " + fileName + ":");
            if (newFileName) {
                fetch(`/rename/${encodeURIComponent(currentDir)}/${encodeURIComponent(fileName)}?new_name=${encodeURIComponent(newFileName)}`, {
                    method: "GET"
                })
                    .then(response => {
                        if (response.ok) {
                            location.reload(); // Refresh page after renaming
                        } else {
                            response.text().then(text => alert("Error: " + text));
                        }
                    })
                    .catch(error => alert("Request failed: " + error));
            }
        }

        function deleteFile(currentDir, fileName) {
            if (confirm("Are you sure you want to delete " + fileName + "?")) {
                fetch(`/delete/${encodeURIComponent(currentDir)}/${encodeURIComponent(fileName)}`, {
                    method: "DELETE"
                })
                    .then(response => {
                        if (response.ok) {
                            location.reload(); // Refresh after deletion
                        } else {
                            response.text().then(text => alert("Error: " + text));
                        }
                    })
                    .catch(error => alert("Request failed: " + error));
            }
        }

        // Toggle the visibility of the filter panel
        function toggleFilterPanel() {
            const filterPanel = document.getElementById('filter-panel');
            filterPanel.style.display = (filterPanel.style.display === 'none' || filterPanel.style.display === '') ? 'block' : 'none';
        }

        // Apply the selected filters
        function applyFilter() {
            const selectedFilters = Array.from(document.querySelectorAll('.file-filter:checked'))
                .map(input => input.value);
            const files = document.querySelectorAll('.file-item');

            files.forEach(file => {
                const fileType = file.getAttribute('data-filetype');
                if (selectedFilters.length === 0 || selectedFilters.includes(fileType)) {
                    file.style.display = 'flex';
                } else {
                    file.style.display = 'none';
                }
            });

            // Save filter state to localStorage
            localStorage.setItem('fileFilters', JSON.stringify(selectedFilters));

            // Show/hide reset button
            const resetBtn = document.getElementById('resetFilterBtn');
            if (selectedFilters.length > 0) {
                resetBtn.style.display = 'block';
            } else {
                resetBtn.style.display = 'none';
            }

            // Close the filter panel after applying
            const filterPanel = document.getElementById('filter-panel');
            filterPanel.style.display = 'none';
        }

        // Reset all filters
        function resetFilter() {
            // Uncheck all filter checkboxes
            document.querySelectorAll('.file-filter').forEach(checkbox => {
                checkbox.checked = false;
            });

            // Show all files
            document.querySelectorAll('.file-item').forEach(file => {
                file.style.display = 'flex';
            });

            // Clear saved filter state
            localStorage.removeItem('fileFilters');

            // Hide reset button
            document.getElementById('resetFilterBtn').style.display = 'none';
        }

        // Load saved filters on page load
        function loadSavedFilters() {
            const savedFilters = localStorage.getItem('fileFilters');
            if (savedFilters) {
                const filterArray = JSON.parse(savedFilters);

                // Check the saved filter checkboxes
                filterArray.forEach(filterValue => {
                    const checkbox = document.querySelector(`.file-filter[value="${filterValue}"]`);
                    if (checkbox) {
                        checkbox.checked = true;
                    }
                });

                // Apply the saved filters
                applyFilter();
            }
        }

        // Load saved filters when page loads
        document.addEventListener('DOMContentLoaded', loadSavedFilters);

        // Toggle the visibility of the dropdown menu
        function showContextMenu(event, fileName) {
            event.preventDefault();

            // Hide all context menus
            const allMenus = document.querySelectorAll('.context-menu');
            allMenus.forEach(menu => {
                menu.style.display = 'none';
            });

            // Show the context menu for this file
            const contextMenu = document.getElementById('context-' + fileName);
            contextMenu.style.top = event.pageY + 'px';
            contextMenu.style.left = event.pageX + 'px';
            contextMenu.style.display = 'block';
        }

        // Close all context menus when clicking outside
        window.addEventListener('click', function (event) {
            const allMenus = document.querySelectorAll('.context-menu');
            allMenus.forEach(menu => {
                if (!menu.contains(event.target)) {
                    menu.style.display = 'none';
                }
            });
        });



        // Close the filter panel if clicking outside
        window.addEventListener('click', function (event) {
            const filterPanel = document.getElementById('filter-panel');
            const filterButton = document.getElementById('filter-btn');

            if (!filterPanel.contains(event.target) && event.target !== filterButton) {
                filterPanel.style.display = 'none';
            }
        });

        // Bookmark functions
        function addBookmark() {
            const currentPath = "{{ current_dir }}";
            const defaultName = currentPath.split('/').pop() || currentPath.split('\\').pop() || "Bookmark";
            const bookmarkName = prompt("Enter bookmark name:", defaultName);

            if (bookmarkName && bookmarkName.trim()) {
                console.log('Adding bookmark:', { path: currentPath, name: bookmarkName.trim() });

                fetch('/add_bookmark', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        path: currentPath,
                        name: bookmarkName.trim()
                    })
                })
                    .then(response => {
                        console.log('Response status:', response.status);
                        return response.json();
                    })
                    .then(data => {
                        console.log('Response data:', data);
                        if (data.success) {
                            location.reload();
                        } else {
                            alert('Error: ' + data.error);
                        }
                    })
                    .catch(error => {
                        console.error('Request failed:', error);
                        alert('Request failed: ' + error);
                    });
            }
        }

        function removeBookmark(path) {
            if (confirm('Remove this bookmark?')) {
                console.log('Removing bookmark:', path);

                fetch('/remove_bookmark', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        path: path
                    })
                })
                    .then(response => {
                        console.log('Remove response status:', response.status);
                        return response.json();
                    })
                    .then(data => {
                        console.log('Remove response data:', data);
                        if (data.success) {
                            refreshBookmarkDropdown();
                        } else {
                            alert('Error: ' + data.error);
                        }
                    })
                    .catch(error => {
                        console.error('Remove request failed:', error);
                        alert('Request failed: ' + error);
                    });
            }
        }

        function moveBookmark(path, direction) {
            console.log('Moving bookmark:', path, direction);

            fetch('/move_bookmark', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    path: path,
                    direction: direction
                })
            })
                .then(response => {
                    console.log('Move response status:', response.status);
                    return response.json();
                })
                .then(data => {
                    console.log('Move response data:', data);
                    if (data.success) {
                        refreshBookmarkDropdown();
                    } else {
                        alert('Error: ' + data.error);
                    }
                })
                .catch(error => {
                    console.error('Move request failed:', error);
                    alert('Request failed: ' + error);
                });
        }

        function refreshBookmarkDropdown() {
            fetch('/get_bookmarks')
                .then(response => response.json())
                .then(data => {
                    const dropdown = document.getElementById('bookmarkDropdown');
                    if (data.bookmarks && data.bookmarks.length > 0) {
                        dropdown.innerHTML = data.bookmarks.map(bookmark => `
                            <div class="bookmark-item">
                                <a href="/?dir_path=${encodeURIComponent(bookmark.path)}&drive=${encodeURIComponent(bookmark.path)}"
                                    onclick="closeBookmarkDropdown()">
                                    <i class="nf nf-fa-folder"></i> ${bookmark.name}
                                </a>
                                <div class="bookmark-controls">
                                    <span class="bookmark-move-up" 
                                        onclick="event.stopPropagation(); moveBookmark('${bookmark.path.replace(/'/g, "\\'")}', 'up');"
                                        title="Move up">‚Üë</span>
                                    <span class="bookmark-move-down" 
                                        onclick="event.stopPropagation(); moveBookmark('${bookmark.path.replace(/'/g, "\\'")}', 'down');"
                                        title="Move down">‚Üì</span>
                                    <span class="bookmark-remove"
                                        onclick="event.stopPropagation(); removeBookmark('${bookmark.path.replace(/'/g, "\\'")}');"
                                        title="Remove">√ó</span>
                                </div>
                            </div>
                        `).join('');
                    } else {
                        dropdown.innerHTML = '<div style="padding: 10px 15px; color: #999; font-style: italic; text-align: center;">No bookmarks yet</div>';
                    }
                })
                .catch(error => {
                    console.error('Failed to refresh bookmarks:', error);
                });
        }

        function toggleBookmarkDropdown(event) {
            event.stopPropagation();
            const dropdown = document.getElementById('bookmarkDropdown');

            // Close all other dropdowns first
            document.querySelectorAll('.dropdown-menu').forEach(menu => {
                menu.style.display = 'none';
            });

            // Toggle bookmark dropdown
            if (dropdown.style.display === 'block') {
                dropdown.style.display = 'none';
            } else {
                dropdown.style.display = 'block';
            }
        }

        function closeBookmarkDropdown() {
            const dropdown = document.getElementById('bookmarkDropdown');
            dropdown.style.display = 'none';
        }

        // Open current directory in Windows Explorer
        function openInExplorer() {
            const currentPath = "{{ current_dir }}";

            fetch('/open_explorer', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    path: currentPath
                })
            })
                .then(response => response.json())
                .then(data => {
                    if (!data.success) {
                        alert('Error: ' + data.error);
                    }
                })
                .catch(error => {
                    console.error('Request failed:', error);
                    alert('Request failed: ' + error);
                });
        }

        // Close bookmark dropdown when clicking outside
        document.addEventListener('click', function (event) {
            const dropdown = document.getElementById('bookmarkDropdown');
            const bookmarkButton = document.querySelector('.bookmark-dropdown button');

            // If click is outside the dropdown and not on the button, close it
            if (!dropdown.contains(event.target) && !bookmarkButton.contains(event.target)) {
                dropdown.style.display = 'none';
            }
        });

        // Move folder functionality for main browser
        function toggleMoveFolderDropdown(event) {
            event.stopPropagation();
            const dropdown = document.getElementById('moveFolderDropdown');

            if (dropdown.classList.contains('show')) {
                dropdown.classList.remove('show');
            } else {
                loadMoveFoldersMain();
                dropdown.classList.add('show');
            }
        }

        function loadMoveFoldersMain() {
            fetch('/get_move_folders')
                .then(response => response.json())
                .then(data => {
                    const dropdown = document.getElementById('moveFolderDropdown');
                    if (data.folders && data.folders.length > 0) {
                        dropdown.innerHTML = data.folders.map(folder => `
                            <div class="bookmark-item">
                                <a href="/?dir_path=${encodeURIComponent(folder.path)}&drive=${encodeURIComponent(folder.path)}">
                                    <i class="nf nf-fa-folder"></i> ${folder.name}
                                </a>
                                <div class="bookmark-controls">
                                    <span class="bookmark-move-up" 
                                        onclick="event.stopPropagation(); moveMoveFolder('${folder.path.replace(/'/g, "\\'")}', 'up');"
                                        title="Move up">‚Üë</span>
                                    <span class="bookmark-move-down" 
                                        onclick="event.stopPropagation(); moveMoveFolder('${folder.path.replace(/'/g, "\\'")}', 'down');"
                                        title="Move down">‚Üì</span>
                                    <span class="bookmark-remove"
                                        onclick="event.stopPropagation(); removeMoveFolder('${folder.path.replace(/'/g, "\\'")}');"
                                        title="Remove">√ó</span>
                                </div>
                            </div>
                        `).join('');
                    } else {
                        dropdown.innerHTML = '<div style="padding: 10px 15px; color: #999; font-style: italic; text-align: center;">No move folders yet</div>';
                    }
                })
                .catch(error => {
                    console.error('Failed to load move folders:', error);
                });
        }

        function refreshMoveFolderDropdown() {
            fetch('/get_move_folders')
                .then(response => response.json())
                .then(data => {
                    const dropdown = document.getElementById('moveFolderDropdown');
                    if (data.folders && data.folders.length > 0) {
                        dropdown.innerHTML = data.folders.map(folder => `
                            <div class="bookmark-item">
                                <a href="/?dir_path=${encodeURIComponent(folder.path)}&drive=${encodeURIComponent(folder.path)}">
                                    <i class="nf nf-fa-folder"></i> ${folder.name}
                                </a>
                                <div class="bookmark-controls">
                                    <span class="bookmark-move-up" 
                                        onclick="event.stopPropagation(); moveMoveFolder('${folder.path.replace(/'/g, "\\'")}', 'up');"
                                        title="Move up">‚Üë</span>
                                    <span class="bookmark-move-down" 
                                        onclick="event.stopPropagation(); moveMoveFolder('${folder.path.replace(/'/g, "\\'")}', 'down');"
                                        title="Move down">‚Üì</span>
                                    <span class="bookmark-remove"
                                        onclick="event.stopPropagation(); removeMoveFolder('${folder.path.replace(/'/g, "\\'")}');"
                                        title="Remove">√ó</span>
                                </div>
                            </div>
                        `).join('');
                    } else {
                        dropdown.innerHTML = '<div style="padding: 10px 15px; color: #999; font-style: italic; text-align: center;">No move folders yet</div>';
                    }
                })
                .catch(error => {
                    console.error('Failed to refresh move folders:', error);
                });
        }

        function addMoveFolder() {
            const currentPath = "{{ current_dir }}";
            const defaultName = currentPath.split('/').pop() || currentPath.split('\\').pop() || "Folder";
            const folderName = prompt("Enter move folder name:", defaultName);

            if (folderName && folderName.trim()) {
                fetch('/add_move_folder', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        path: currentPath,
                        name: folderName.trim()
                    })
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            refreshMoveFolderDropdown();
                        } else {
                            alert('Error: ' + data.error);
                        }
                    })
                    .catch(error => {
                        console.error('Request failed:', error);
                        alert('Request failed: ' + error);
                    });
            }
        }

        function removeMoveFolder(path) {
            if (confirm('Remove this move folder?')) {
                fetch('/remove_move_folder', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        path: path
                    })
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            refreshMoveFolderDropdown();
                        } else {
                            alert('Error: ' + data.error);
                        }
                    })
                    .catch(error => {
                        console.error('Request failed:', error);
                        alert('Request failed: ' + error);
                    });
            }
        }

        function moveMoveFolder(path, direction) {
            console.log('Moving move folder:', path, direction);

            fetch('/move_move_folder', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    path: path,
                    direction: direction
                })
            })
                .then(response => {
                    console.log('Move response status:', response.status);
                    return response.json();
                })
                .then(data => {
                    console.log('Move response data:', data);
                    if (data.success) {
                        refreshMoveFolderDropdown();
                    } else {
                        console.error('Move error:', data.error);
                        alert('Error: ' + data.error);
                    }
                })
                .catch(error => {
                    console.error('Request failed:', error);
                    alert('Request failed: ' + error);
                });
        }

        function toggleMoveFolderDropdown(event) {
            event.stopPropagation();
            const dropdown = document.getElementById('moveFolderDropdown');

            // Close all other dropdowns first
            document.querySelectorAll('.bookmark-dropdown-content').forEach(menu => {
                menu.classList.remove('show');
            });

            if (dropdown.classList.contains('show')) {
                dropdown.classList.remove('show');
            } else {
                loadMoveFoldersMain();
                dropdown.classList.add('show');
            }
        }

        // Close move folder dropdown when clicking outside
        window.addEventListener('click', function (event) {
            const moveFolderDropdown = document.getElementById('moveFolderDropdown');
            if (!event.target.closest('.bookmark-dropdown') || event.target.closest('#bookmarkDropdown')) {
                moveFolderDropdown.classList.remove('show');
            }
        });
    </script>


</body>

</html>