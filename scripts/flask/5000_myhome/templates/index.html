<!DOCTYPE html>
<html>

<head>
  <title>Home</title>
  <link rel="shortcut icon" href="https://cdn-icons-png.flaticon.com/512/4021/4021539.png" type="image/x-icon">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="../static/style.css">
</head>

<body>
  <div class="top-center-controls">
    <div class="notification-button-container">
      <a href="#" id="tv-button" class="add-button"><i class="nf nf-md-television_classic"></i></a>
      <span id="tv-notification-badge" class="notification-badge" style="display: none;">0</span>
    </div>
    <div class="notification-button-container">
      <a href="#" id="movie-button" class="add-button"><i class="nf nf-md-movie_roll"></i></a>
      <span id="movie-notification-badge" class="notification-badge" style="display: none;">0</span>
    </div>
    <a href="http://192.168.0.101:5003/" class="add-button" target="_blank"><i class="nf nf-fa-hard_drive"></i></a>
    <a href="http://192.168.0.101:5015/" class="add-button" target="_blank"><i class="nf nf-md-book_education"></i></a>
    <a href="http://192.168.0.101:4999/" class="add-button" target="_blank"><i class="nf nf-fa-rocket"></i></a>
    <a href="http://192.168.0.101:4998/" class="add-button" target="_blank"><i class="nf nf-oct-apps"></i></a>
    <a href="http://192.168.0.101:5555/" class="add-button" target="_blank"><i class="nf nf-dev-terminal"></i></a>
    <!-- <a href="http://192.168.0.101:5003/" class="add-button" target="_blank"><img src="https://cdn-icons-png.flaticon.com/512/2250/2250195.png" height="25px" width="25px" alt=""></a> -->
  </div>

  <div class="flex-container2">

    <div class="toggle-container" style="margin-left: 25px;">
      <label class="switch">
        <input type="checkbox" id="edit-mode-toggle">
        <span class="slider round"></span>
      </label>
      <span style="color: white; margin-left: 10px;">Modify</span>
    </div>

    <!-- Updated styling for better edit mode control -->
    <style>
      .dragging {
        opacity: 0.5;
      }
      
      .reorder-buttons {
        display: none;
        flex-direction: column;
        gap: 2px;
        margin-left: 5px;
      }
      .edit-mode .reorder-buttons {
        display: none;
      }
      .reorder-btn {
        background: #333;
        color: white;
        background-color: rgb(255, 218, 54);
        border: none;
        padding: 2px 6px;
        cursor: pointer;
        font-size: 12px;
        border-radius: 3px;
      }
      .reorder-btn:hover {
        background: #555;
      }
      
      /* Group reorder buttons - only visible in edit mode */
      .group-reorder-buttons {
        display: none;
        gap: 5px;
        margin-left: 10px;
      }
      .edit-mode .group-reorder-buttons {
        display: flex;
      }
      
      .link-item {
        cursor: move;
      }

      /* Notification badge styles */
      .notification-button-container {
        position: relative;
        display: inline-block;
      }
      
      .notification-badge {
        position: absolute;
        top: -8px;
        right: -8px;
        background-color: #ff4444;
        color: white;
        border-radius: 50%;
        padding: 2px 6px;
        font-size: 12px;
        font-weight: bold;
        min-width: 18px;
        text-align: center;
        box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        z-index: 1000;
      }
      
      .notification-badge.zero {
        display: none !important;
      }

    </style>

  <div id="links-container" style="display: flex; width: 100%; flex-wrap: wrap; justify-content: left; flex-direction: row;">
  </div>

<div id="edit-group-popup" class="popup-container hidden">
    <div class="popup-content">
      <span class="close-button">&times;</span>
      <h3>Group Settings</h3>
      <form id="edit-group-form" style="display: flex; flex-direction: column; gap: 10px; width: 400px;">
        <input type="hidden" id="edit-group-original-name">
        <label for="edit-group-name">Group Name:</label>
        <input type="text" id="edit-group-name" placeholder="Enter group name (leave empty for 'Ungrouped')" required>
        <label for="edit-group-display">Display Style:</label>
        <select id="edit-group-display">
          <option value="flex">Flex</option>
          <option value="list-item">List Item</option>
        </select>
        <div style="display: flex; align-items: center; gap: 10px;">
          <label for="edit-group-collapsible">
            <input type="checkbox" id="edit-group-collapsible">
            Enable Collapsible Toggle (shows at top when enabled)
          </label>
        </div>
        <div style="display: flex; align-items: center; gap: 10px;">
          <label for="edit-group-horizontal-stack">
            <input type="checkbox" id="edit-group-horizontal-stack">
            Stack Horizontally
          </label>
        </div>
        <div style="display: flex; align-items: center; gap: 10px;">
          <label for="edit-group-password-protect">
            <input type="checkbox" id="edit-group-password-protect">
            Require Password to Extend
          </label>
        </div>
        <div id="collapsible-rename-section" style="display: none;">
          <h4 style="color: white; margin: 15px 0 10px 0; border-bottom: 1px solid #555; padding-bottom: 5px;">Top Group Display Settings</h4>
          
          <label for="edit-group-top-name">Display Name (optional):</label>
          <input type="text" id="edit-group-top-name" placeholder="Custom name for top display (leave empty to use group name)">
          
          <h4 style="color: white; margin: 15px 0 10px 0; border-bottom: 1px solid #555; padding-bottom: 5px;">Top Group Color Settings</h4>
          
          <div style="display: flex; gap: 10px;">
            <input type="text" id="edit-group-top-bg-color" placeholder="Background Color (e.g., #2d2d2d or blue)">
            <input type="text" id="edit-group-top-text-color" placeholder="Text Color (e.g., #ffffff or white)">
          </div>
          
          <div style="display: flex; gap: 10px;">
            <input type="text" id="edit-group-top-border-color" placeholder="Border Color (e.g., #444444 or gray)">
            <input type="text" id="edit-group-top-hover-color" placeholder="Hover Color (e.g., #3a3a3a or darkgray)">
          </div>
        </div>
        <button type="submit">Save Group Settings</button>
      </form>
    </div>
  </div>

  <div id="add-link-popup" class="popup-container hidden">
    <div class="popup-content">
      <span class="close-button">&times;</span>
      <h3>Add New Link</h3>
      <form id="add-link-form" style="display: flex; flex-direction: column; gap: 10px; width: 400px;">
        <input type="text" id="link-name" placeholder="Name" required>
        <input type="text" id="link-group" placeholder="Group (optional)">
        <input type="url" id="link-url" placeholder="URL" required>
        <label for="link-default-type">Default Type:</label>
        <select id="link-default-type">
          <option value="nerd-font">nerd-font</option>
          <option value="img">img</option>
          <option value="text">text</option>
        </select>
        <div style="display: flex; gap: 10px;">
          <input type="text" id="link-text" placeholder="Text (if no icon/image)">
          <input type="url" id="link-img-src" placeholder="Image URL (if no icon)">
          <input type="text" id="link-icon-class" placeholder="Icon Class (e.g., nf nf-cod-mail)">
        </div>
        <div style="display: flex; gap: 10px;">
          <input type="text" id="link-color" placeholder="Color (e.g., #f46613 or red)">
          <input type="text" id="link-background-color" placeholder="Background Color">
        </div>
        <input type="text" id="link-font-size" placeholder="Font Size (e.g., 16px)">
        <div style="display: flex; gap: 10px;">
          <input type="text" id="link-li-bg-color" placeholder="List Item BG Color">
          <input type="text" id="link-li-hover-color" placeholder="List Item Hover Color">
        </div>
        <input type="text" id="link-border-radius" placeholder="Border Radius">
        <input type="text" id="link-title" placeholder="Title (for tooltip)">
        <div style="display: flex; align-items: center; gap: 10px;">
          <label for="link-hidden">
            <input type="checkbox" id="link-hidden">
            Hide this item
          </label>
        </div>
        <button type="submit">Add Link</button>
      </form>
    </div>
  </div>

  <div id="edit-link-popup" class="popup-container hidden">
    <div class="popup-content">
      <span class="close-button">&times;</span>
      <h3>Edit Link</h3>
      <form id="edit-link-form" style="display: flex; flex-direction: column; gap: 10px; width: 400px;">
        <input type="hidden" id="edit-link-index">
        <input type="text" id="edit-link-name" placeholder="Name" required>
        <input type="text" id="edit-link-group" placeholder="Group (optional)">
        <input type="url" id="edit-link-url" placeholder="URL" required>
        <label for="edit-link-default-type">Default Type:</label>
        <select id="edit-link-default-type">
          <option value="nerd-font">nerd-font</option>
          <option value="img">img</option>
          <option value="text">text</option>
        </select>
        <div style="display: flex; gap: 10px;">
          <input type="text" id="edit-link-text" placeholder="Text (if no icon/image)">
          <input type="url" id="edit-link-img-src" placeholder="Image URL (if no icon)">
          <input type="text" id="edit-link-icon-class" placeholder="Icon Class (e.g., nf nf-cod-mail)">
        </div>
        <div style="display: flex; gap: 10px;">
          <input type="text" id="edit-link-width" placeholder="Width (e.g., 50)">
          <input type="text" id="edit-link-height" placeholder="Height (e.g., 50)">
        </div>
        <div style="display: flex; gap: 10px;">
          <input type="text" id="edit-link-color" placeholder="Color (e.g., #f46613 or red)">
          <input type="text" id="edit-link-background-color" placeholder="Background Color">
        </div>
        <input type="text" id="edit-link-font-size" placeholder="Font Size (e.g., 16px)">
        <div style="display: flex; gap: 10px;">
          <input type="text" id="edit-link-li-bg-color" placeholder="List Item BG Color">
          <input type="text" id="edit-link-li-hover-color" placeholder="List Item Hover Color">
        </div>
        <input type="text" id="edit-link-border-radius" placeholder="Border Radius">
        <input type="text" id="edit-link-title" placeholder="Title (for tooltip)">
        <div style="display: flex; align-items: center; gap: 10px;">
          <label for="edit-link-hidden">
            <input type="checkbox" id="edit-link-hidden">
            Hide this item
          </label>
        </div>
        <button type="submit">Save Changes</button>
      </form>
    </div>
  </div>

  <div id="horizontal-stack-popup" class="popup-container hidden">
    <div class="popup-content">
      <span class="close-button">&times;</span>
      <h3>Group Items</h3>
      <div class="popup-content-inner" style="display: flex; flex-wrap: wrap; gap: 10px;"></div>
    </div>
  </div>




  <script src="../static/links-handler.js"></script>
  <script src="../static/main.js"></script>

  <script>
    // TV and Movie notification functionality
    let tvNotificationCount = 0;
    let movieNotificationCount = 0;
    
    // Function to update TV notification badge
    function updateTVNotifications() {
      fetch('/api/tv-notifications')
        .then(response => response.json())
        .then(data => {
          tvNotificationCount = data.unseen_count || 0;
          const badge = document.getElementById('tv-notification-badge');
          
          if (tvNotificationCount > 0) {
            badge.textContent = tvNotificationCount;
            badge.style.display = 'block';
            badge.classList.remove('zero');
          } else {
            badge.style.display = 'none';
            badge.classList.add('zero');
          }
        })
        .catch(error => {
          console.error('Error fetching TV notifications:', error);
        });
    }
    
    // Function to update Movie notification badge
    function updateMovieNotifications() {
      fetch('/api/movie-notifications')
        .then(response => response.json())
        .then(data => {
          movieNotificationCount = data.unseen_count || 0;
          const badge = document.getElementById('movie-notification-badge');
          
          if (movieNotificationCount > 0) {
            badge.textContent = movieNotificationCount;
            badge.style.display = 'block';
            badge.classList.remove('zero');
          } else {
            badge.style.display = 'none';
            badge.classList.add('zero');
          }
        })
        .catch(error => {
          console.error('Error fetching movie notifications:', error);
        });
    }
    
    // Function to mark all TV episodes as seen
    function markAllTVSeen() {
      if (tvNotificationCount === 0) {
        // If no notifications, just open the TV app
        window.open('http://192.168.0.101:5011/', '_blank');
        return;
      }
      
      // Show confirmation dialog
      if (confirm(`Mark all ${tvNotificationCount} unseen episodes as seen?`)) {
        fetch('/api/mark-all-tv-seen', { method: 'POST' })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              console.log(`Marked ${data.updated_count} episodes as seen`);
              updateTVNotifications(); // Refresh the count
              // Open TV app after marking as seen
              window.open('http://192.168.0.101:5011/', '_blank');
            } else {
              console.error('Failed to mark episodes as seen:', data.error);
              alert('Failed to mark episodes as seen');
            }
          })
          .catch(error => {
            console.error('Error marking episodes as seen:', error);
            alert('Error marking episodes as seen');
          });
      }
    }
    
    // Function to mark all movies as seen
    function markAllMoviesSeen() {
      if (movieNotificationCount === 0) {
        // If no notifications, just open the movie app
        window.open('http://192.168.0.101:5013/', '_blank');
        return;
      }
      
      // Show confirmation dialog
      if (confirm(`Mark all ${movieNotificationCount} unseen movies as seen?`)) {
        fetch('/api/mark-all-movies-seen', { method: 'POST' })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              console.log(`Marked ${data.updated_count} movies as seen`);
              updateMovieNotifications(); // Refresh the count
              // Open movie app after marking as seen
              window.open('http://192.168.0.101:5013/', '_blank');
            } else {
              console.error('Failed to mark movies as seen:', data.error);
              alert('Failed to mark movies as seen');
            }
          })
          .catch(error => {
            console.error('Error marking movies as seen:', error);
            alert('Error marking movies as seen');
          });
      }
    }
    
    // Add click handlers
    document.getElementById('tv-button').addEventListener('click', function(e) {
      e.preventDefault();
      markAllTVSeen();
    });
    
    document.getElementById('movie-button').addEventListener('click', function(e) {
      e.preventDefault();
      markAllMoviesSeen();
    });
    
    // Update notifications on page load
    updateTVNotifications();
    updateMovieNotifications();
    
    // Update notifications every 30 seconds
    setInterval(() => {
      updateTVNotifications();
      updateMovieNotifications();
    }, 30000);
  </script>

  </div>
</body>

</html>