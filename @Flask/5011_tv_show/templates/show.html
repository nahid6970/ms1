
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ show.title }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="show-details-container">
        <div class="show-cover">
            <img src="{{ show.cover_image }}" alt="{{ show.title }}">
            <h2>{{ show.title }}</h2>
            <div class="stars-container{% if show.rating %} rating-{{ show.rating | int }}{% endif %}" style="margin-bottom: 15px;">
                {% if show.rating %}
                    {% for i in range(show.rating | int) %}
                        <svg viewBox="0 0 24 24" class="star-svg">
                            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26" />
                        </svg>
                    {% endfor %}
                {% endif %}
            </div>
            <form action="{{ url_for('add_episode', show_id=show.id) }}" method="post" style="display: flex; justify-content: center; align-items: center; gap: 5px; margin-bottom: 10px;">
                <input type="text" name="title" placeholder="New episode title" required style="flex-grow: 1;">
                <button type="submit" class="form-action-button add-episode-button">+</button>
                <a href="{{ url_for('scan_manual', show_id=show.id) }}" class="form-action-button"><i class="nf nf-oct-sync"></i></a>
            </form>
            <div style="display: flex; justify-content: center; gap: 10px;">
                <a href="{{ url_for('index') }}" class="add-button home-button" style="background-color: white; color: black;"><i class="nf nf-cod-home"></i></a>
                <button onclick="openEditShowModal({{ show.id }})" class="add-button" style="background-color: #28a745; color: white;" title="Edit show">
                    <i class="nf nf-fa-edit"></i>
                </button>
                {% if show.directory_path %}
                    <a href="{{ url_for('open_folder', show_id=show.id) }}" class="add-button" style="background-color: #ffc936; color: black;" title="Open show folder" onclick="openFolderViaServer(event, {{ show.id }})">
                        <i class="nf nf-fa-folder"></i>
                    </a>
                {% endif %}
                <a href="{{ show.sonarr_url if show.sonarr_url else 'http://192.168.0.101:8989/series/' ~ show.title.lower().replace(' ', '-').replace(':', '').replace('!', '').replace('?', '').replace(',', '').replace('(', '').replace(')', '').replace('[', '').replace(']', '').replace('&', 'and').replace('.', '') }}" target="_blank" class="add-button" style="background-color: #007bff; color: white;" title="Open in Sonarr">
                    <i class="nf nf-fa-external_link"></i>
                </a>
                {% if sort_episodes == 'alphabetical' %}
                    <a href="{{ url_for('show', show_id=show.id, sort_episodes='alphabetical', order=next_order) }}" class="add-button sort-episodes-button" style="background-color: #ffc936; color: black;" title="Sort episodes alphabetically {{ 'descending' if order == 'asc' else 'ascending' }}">
                        <i class="nf nf-fa-sort_alpha_{{ 'desc' if order == 'asc' else 'asc' }}"></i>
                    </a>
                {% else %}
                    <a href="{{ url_for('show', show_id=show.id, sort_episodes='alphabetical', order='asc') }}" class="add-button sort-episodes-button" style="background-color: #e0e0e0; color: black;" title="Sort episodes alphabetically ascending">
                        <i class="nf nf-fa-sort_alpha_asc"></i>
                    </a>
                {% endif %}
            </div>
        </div>
        <div class="episode-list">
            <ul>
                {% for episode in show.episodes %}
                    <li class="episode-item{% if episode.watched %} episode-watched{% endif %}">
                        <span class="episode-title">
                            <input type="checkbox" {% if episode.watched %}checked{% endif %} onchange="window.location.href='{{ url_for('toggle_watched', show_id=show.id, episode_id=episode.id) }}'">
                            {{ episode.title }}
                        </span>
                        <span class="episode-controls">
                            <a href="#" onclick="openEditEpisodeModal({{ show.id }}, {{ episode.id }})" class="edit-dot"></a>
                            <a href="{{ url_for('delete_episode', show_id=show.id, episode_id=episode.id) }}" class="delete-dot" onclick="return confirm('Are you sure you want to delete this episode?')"></a>
                        </span>
                    </li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <!-- The Edit Episode Modal -->
    <div id="editEpisodeModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditEpisodeModal()">&times;</span>
            <h2>Edit Episode</h2>
            <form id="editEpisodeForm" action="/edit_episode" method="post">
                <input type="hidden" id="editEpisodeShowId" name="show_id">
                <input type="hidden" id="editEpisodeId" name="id">
                <label for="editEpisodeTitle">Title:</label>
                <input type="text" id="editEpisodeTitle" name="title" required>
                <button type="submit">Save Changes</button>
            </form>
        </div>
    </div>

    <!-- The Edit Show Modal -->
    <div id="editShowModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditShowModal()">&times;</span>
            <h2>Edit Show</h2>
            <form id="editShowForm" action="/edit_show" method="post">
                <input type="hidden" id="editShowId" name="id">
                <label for="editShowTitle">Title:</label>
                <input type="text" id="editShowTitle" name="title" required>
                <label for="editShowYear">Year:</label>
                <input type="number" id="editShowYear" name="year">
                <label for="editShowCoverImage">Cover Image URL:</label>
                <input type="url" id="editShowCoverImage" name="cover_image">
                <label for="editShowDirectoryPath">Directory Path (Optional):</label>
                <input type="text" id="editShowDirectoryPath" name="directory_path">
                <label for="editShowSonarrUrl">Sonarr Link:</label>
                <input type="url" id="editShowSonarrUrl" name="sonarr_url">
                <label for="editShowStatus">Status:</label>
                <select id="editShowStatus" name="status" class="setting-select">
                    <option value="Continuing">Continuing</option>
                    <option value="Ended">Ended</option>
                </select>
                <div class="rating-group">
                    <label><input type="radio" name="rating" value="1"> <span>1</span></label>
                    <label><input type="radio" name="rating" value="2"> <span>2</span></label>
                    <label><input type="radio" name="rating" value="3"> <span>3</span></label>
                    <label><input type="radio" name="rating" value="4"> <span>4</span></label>
                    <label><input type="radio" name="rating" value="5"> <span>5</span></label>
                </div><br>
                <button type="submit">Save Changes</button>
            </form>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
